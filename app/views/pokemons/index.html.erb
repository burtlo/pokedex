<div class="search span12">
  <div class="offset2 span10">
    <form class="form-search">
      <input id="pokemon-search" type="text" class="input-medium search-query" style="width: 100%;">
    </form>
  </div>
</div>

<%= render partial: "pokemon_clientside" %>

<div class="span11" id="pokemon-results">
</div>

<script>
  $(function() {

    lastSearchText = "";

    $("#pokemon-search").keypress(function(e) {
      if(e.which == 13) {
        e.preventDefault();
      }
    });

    $("#pokemon-search").on("keyup",function(eventObj) {

      var searchText = $(this).val();

      console.log("searching for " + searchText);

      if (eventObj.which == 13) { return; }

      if (searchText === lastSearchText) { return; }

      lastSearchText = searchText;

      if (searchText.length < 2) {
        var resultsHtml = $("#pokemon-results");
        resultsHtml.html("");
        return;
      }

      $.ajax("/pokemons/search", { type: "POST",
        data: { query: searchText },
        success: function(data,textStatus,jqXHR) {
          // console.log("Success");
          console.log(data);

          var resultsHtml = $("#pokemon-results");

          resultsHtml.html("");

          var templateSource = $("#pokemon-index-template").html();
          var template = Handlebars.compile(templateSource);
          $.each(data.pokemon,function(index,elem) {
            var pokemonHtml = template(elem);
            resultsHtml.append(pokemonHtml);
          });

        },
        error: function() {
          // console.log("failure");
        }
      });
    })
  });

</script>