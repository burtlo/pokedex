<div class="search span12">
  <div class="offset2 span9">
    <form class="form-search">
      <input id="pokemon-search" type="text" class="input-medium search-query" style="width: 100%;">
    </form>
  </div>
</div>

<script id="pokemon-index-template" type="text/x-handlebars-template">
  <div class="pokemon-entry span12">
    <div class="span3">
      <h4>{{name}}</h4>

      <img src="{{image}}" />
    </div>
    <div class="span4 effective-attack">
    <h5>Attack With</h5>
    {{#effectiveAttacks}}
      <div class="attack {{name}}">
      {{name}}
      <span class="multiplier">(x{{multiplier}})</span>
    </div>
    {{/effectiveAttacks}}
    </div>
    <div class="span4 ineffective-attack">
    <h5>Avoid Using</h5>
    {{#ineffectiveAttacks}}
      <div class="attack {{name}}">
        {{name}}
        <span class="multiplier">(x{{multiplier}})</span>
      </div>
    {{/ineffectiveAttacks}}
    </div>
  </div>
</script>

<div class="offset1 span9" id="pokemon-results">
</div>

<script>
  $(function() {

    $("#pokemon-search").keypress(function(e) {
      if(e.which == 13) {
        e.preventDefault();
      }
    });

    $("#pokemon-search").on("keyup",function(eventObj) {

      var searchText = $(this).val();
      console.log("searching for " + searchText);

      if (eventObj.which == 13) { return; }
      if (searchText.length < 2) {
        return;
      }

      $.ajax("/pokemons/search", { type: "POST",
        data: { query: searchText },
        success: function(data,textStatus,jqXHR) {
          // console.log("Success");
          console.log(data);

          var resultsHtml = $("#pokemon-results");

          resultsHtml.html("");

          var templateSource = $("#pokemon-index-template").html();
          var template = Handlebars.compile(templateSource);
          $.each(data.pokemon,function(index,elem) {
            var pokemonHtml = template(elem);
            resultsHtml.append(pokemonHtml);
          });

        },
        error: function() {
          // console.log("failure");
        }
      });
    })
  });

</script>